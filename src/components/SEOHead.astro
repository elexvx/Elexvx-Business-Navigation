---
import { seoConfig, generatePageTitle, generatePageDescription, generateKeywords, generateCanonicalUrl, type PageSEO } from '../config/seo';

export interface Props extends PageSEO {
  title?: string;
  description?: string;
  keywords?: string[];
  image?: string;
  noindex?: boolean;
  canonical?: string;
  type?: 'website' | 'article' | 'product';
}

const {
  title,
  description,
  keywords,
  image,
  noindex = false,
  canonical,
  type = 'website'
} = Astro.props;

const pageTitle = generatePageTitle(title);
const pageDescription = generatePageDescription(description);
const pageKeywords = generateKeywords(keywords);
const pageImage = image || seoConfig.defaultImage;
const canonicalUrl = canonical || generateCanonicalUrl(Astro.url.pathname);
const fullImageUrl = pageImage.startsWith('http') ? pageImage : `${seoConfig.siteUrl}${pageImage}`;
---

<!-- 基础 SEO -->
<title>{pageTitle}</title>
<meta name="description" content={pageDescription} />
<meta name="keywords" content={pageKeywords} />
<meta name="author" content={seoConfig.author} />
<link rel="canonical" href={canonicalUrl} />

<!-- 语言和地区 -->
<html lang={seoConfig.language} />
<meta name="language" content={seoConfig.language} />
<meta name="geo.region" content="CN" />
<meta name="geo.country" content="China" />

<!-- 搜索引擎指令 -->
{noindex ? (
  <meta name="robots" content="noindex, nofollow" />
) : (
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
)}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={pageDescription} />
<meta property="og:image" content={fullImageUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:site_name" content={seoConfig.siteName} />
<meta property="og:locale" content={seoConfig.locale} />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content={seoConfig.twitterHandle} />
<meta name="twitter:creator" content={seoConfig.twitterHandle} />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={pageDescription} />
<meta name="twitter:image" content={fullImageUrl} />

<!-- 额外的 meta 标签 -->
<meta name="theme-color" content="#3b82f6" />
<meta name="msapplication-TileColor" content="#3b82f6" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="format-detection" content="telephone=no" />

<!-- 结构化数据 - 网站信息 -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "{seoConfig.siteName}",
    "description": "{seoConfig.siteDescription}",
    "url": "{seoConfig.siteUrl}",
    "author": {
      "@type": "Organization",
      "name": "{seoConfig.author}"
    },
    "potentialAction": {
      "@type": "SearchAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": "{seoConfig.siteUrl}/?q={search_term_string}"
      },
      "query-input": "required name=search_term_string"
    }
  }
</script>

<!-- 结构化数据 - 组织信息 -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "{seoConfig.siteName}",
    "description": "{seoConfig.siteDescription}",
    "url": "{seoConfig.siteUrl}",
    "logo": {
      "@type": "ImageObject",
      "url": "{seoConfig.siteUrl}/favicon.svg"
    },
    "sameAs": [
      "{seoConfig.twitterHandle ? `https://twitter.com/${seoConfig.twitterHandle.replace('@', '')}` : ''}"
    ]
  }
</script>

{type === 'article' && (
  <!-- 结构化数据 - 文章信息 -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "{pageTitle}",
      "description": "{pageDescription}",
      "image": "{fullImageUrl}",
      "url": "{canonicalUrl}",
      "datePublished": "{new Date().toISOString()}",
      "dateModified": "{new Date().toISOString()}",
      "author": {
        "@type": "Organization",
        "name": "{seoConfig.author}"
      },
      "publisher": {
        "@type": "Organization",
        "name": "{seoConfig.siteName}",
        "logo": {
          "@type": "ImageObject",
          "url": "{seoConfig.siteUrl}/favicon.svg"
        }
      }
    }
  </script>
)}

<!-- 预加载关键资源 -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="dns-prefetch" href="//www.google-analytics.com" />
<link rel="dns-prefetch" href="//fonts.googleapis.com" />

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest" />