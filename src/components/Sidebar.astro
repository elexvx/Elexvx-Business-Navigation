---
import { navigation } from '../config/links';
---

<aside class="w-64 bg-gray-900 text-white h-screen fixed left-0 top-0 z-50 transform transition-transform duration-300 ease-in-out lg:translate-x-0 -translate-x-full flex flex-col" id="sidebar">
  <!-- Logo 区域 -->
  <div class="p-6 border-b border-gray-700 flex-shrink-0">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3 group">
        <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center overflow-hidden">
          <img 
            src="/images/logos/elexvx.png" 
            alt="企业Logo" 
            class="w-8 h-8 object-contain"
          />
        </div>
        <div class="transition-all duration-300 group-hover:translate-x-1">
          <h1 class="text-xl font-bold transition-colors duration-300 group-hover:text-blue-400">企业外链</h1>
          <p class="text-gray-400 text-sm transition-colors duration-300 group-hover:text-gray-300">综合管理平台</p>
        </div>
      </div>
      <!-- 移动端关闭按钮 -->
      <button 
        id="sidebar-close-button"
        class="lg:hidden p-2 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700 transition-colors duration-200"
        aria-label="关闭菜单"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- 导航分类 -->
  <nav class="flex-1 p-4 overflow-y-auto sidebar-scroll">
    {navigation.map((group, groupIndex) => (
      <div class="mb-4">
        {group.subcategories ? (
          <!-- 有二级菜单的分类 -->
          <div>
            <div class="flex items-center">
              <a 
                href={`#category-${group.category.replace(/\s+/g, '-').replace(/[^\u4e00-\u9fa5a-zA-Z0-9\-]/g, '')}`}
                class="flex-1 flex items-center px-3 py-2 text-left text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition-all duration-300 hover:translate-x-1 hover:shadow-md anchor-link group"
              >
                <svg class="w-5 h-5 mr-3 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-12" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                </svg>
                <span class="font-medium transition-all duration-300 group-hover:font-semibold">{group.category}</span>
              </a>
              <button 
                class="p-2 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition-all duration-300 hover:scale-110 hover:rotate-3 category-toggle group"
                data-category={groupIndex}
                aria-label="展开/收起分类"
              >
                <svg class="w-4 h-4 transform transition-all duration-300 chevron group-hover:scale-125" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>
            </div>
            
            <!-- 二级分类列表 -->
            <div class="ml-6 mt-2 space-y-2 subcategory-list overflow-hidden transition-all duration-300 ease-in-out" data-category={groupIndex} style="max-height: 0; opacity: 0;">
              {group.subcategories.map((subcategory) => (
                <a 
                  href={`#subcategory-${group.category.replace(/\s+/g, '-').replace(/[^\u4e00-\u9fa5a-zA-Z0-9\-]/g, '')}-${subcategory.name.replace(/\s+/g, '-').replace(/[^\u4e00-\u9fa5a-zA-Z0-9\-&]/g, '')}`}
                  class="block border-l-2 border-gray-700 pl-4 py-2 text-gray-400 hover:text-white hover:border-blue-500 transition-all duration-300 hover:translate-x-2 hover:bg-gray-800/50 rounded-r-lg anchor-link group border-animate"
                >
                  <div class="text-sm font-medium mb-1 transition-all duration-300 group-hover:font-semibold group-hover:text-blue-300">{subcategory.name}</div>
                  <div class="text-xs text-gray-500 transition-colors duration-300 group-hover:text-gray-400">{subcategory.links.length} 个工具</div>
                </a>
              ))}
            </div>
          </div>
        ) : (
          <!-- 没有二级菜单的分类 -->
          <a 
            href={`#category-${group.category.replace(/\s+/g, '-').replace(/[^\u4e00-\u9fa5a-zA-Z0-9\-]/g, '')}`}
            class="block px-3 py-2 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition-all duration-300 hover:translate-x-1 hover:shadow-md anchor-link group"
          >
            <div class="flex items-center">
              <svg class="w-5 h-5 mr-3 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-12" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
              </svg>
              <div>
                <span class="font-medium transition-all duration-300 group-hover:font-semibold group-hover:text-blue-300">{group.category}</span>
                <div class="text-xs text-gray-500 mt-1 transition-colors duration-300 group-hover:text-gray-400">{group.links?.length || 0} 个工具</div>
              </div>
            </div>
          </a>
        )}
      </div>
    ))}
  </nav>

  <script>
    // 侧边栏分类展开/收起功能
    document.addEventListener('DOMContentLoaded', () => {
      const toggleButtons = document.querySelectorAll<HTMLButtonElement>('.category-toggle');
      const anchorLinks = document.querySelectorAll<HTMLAnchorElement>('.anchor-link');
      const sidebar = document.getElementById('sidebar');
      
      // 分类展开/收起功能（手风琴效果 + 动画）
      toggleButtons.forEach(button => {
        button.addEventListener('click', () => {
          const categoryIndex = button.getAttribute('data-category');
          const subcategoryList = document.querySelector<HTMLElement>(`[data-category="${categoryIndex}"].subcategory-list`);
          const chevron = button.querySelector<HTMLElement>('.chevron');
          
          if (subcategoryList) {
            const isExpanded = subcategoryList.style.maxHeight && subcategoryList.style.maxHeight !== '0px';
            
            // 如果当前分类要展开，先收起所有其他分类
            if (!isExpanded) {
              // 收起所有其他分类（带动画）
              document.querySelectorAll<HTMLElement>('.subcategory-list').forEach(list => {
                if (list !== subcategoryList) {
                  list.style.maxHeight = '0px';
                  list.style.opacity = '0';
                  // 重置对应的箭头（带动画）
                  const otherCategoryIndex = list.getAttribute('data-category');
                  const otherChevron = document.querySelector<HTMLElement>(`[data-category="${otherCategoryIndex}"].category-toggle .chevron`);
                  if (otherChevron) {
                    otherChevron.style.transform = 'rotate(0deg)';
                  }
                }
              });
            }
            
            // 切换当前分类的显示状态（带动画）
            if (isExpanded) {
              // 收起动画
              subcategoryList.style.maxHeight = '0px';
              subcategoryList.style.opacity = '0';
              if (chevron) chevron.style.transform = 'rotate(0deg)';
            } else {
              // 展开动画
              subcategoryList.style.maxHeight = subcategoryList.scrollHeight + 'px';
              subcategoryList.style.opacity = '1';
              if (chevron) chevron.style.transform = 'rotate(90deg)';
            }
          }
        });
      });
      
      // 锚点链接点击处理
      anchorLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const href = link.getAttribute('href');
          if (!href) return;
          const targetId = href.substring(1);
          const targetElement = document.getElementById(targetId);
          
          if (targetElement) {
            // 平滑滚动到目标元素
            targetElement.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
            
            // 在移动端关闭侧边栏
            if (window.innerWidth < 1024) {
              sidebar?.classList.add('-translate-x-full');
            }
          }
        });
      });
    });
  </script>

  <style>
    /* 自定义动画效果 */
    @keyframes breathe {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.3); }
      50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 30px rgba(59, 130, 246, 0.4); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-2px); }
    }
    
    /* Logo 呼吸动画 */
    .logo-breathe {
      animation: breathe 4s ease-in-out infinite;
    }
    
    /* 悬停时的发光效果 */
    .glow-on-hover:hover {
      animation: glow 2s ease-in-out infinite;
    }
    
    /* 浮动效果 */
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    /* 平滑的边框动画 */
    .border-animate {
      position: relative;
      overflow: hidden;
    }
    
    .border-animate::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #3b82f6, transparent);
      transition: left 0.5s ease;
    }
    
    .border-animate:hover::before {
      left: 100%;
    }
    
    /* 自定义滚动条样式 */
    .sidebar-scroll::-webkit-scrollbar {
      width: 4px;
    }
    
    .sidebar-scroll::-webkit-scrollbar-track {
      background: rgba(55, 65, 81, 0.3);
      border-radius: 2px;
    }
    
    .sidebar-scroll::-webkit-scrollbar-thumb {
      background: rgba(59, 130, 246, 0.6);
      border-radius: 2px;
      transition: background 0.3s ease;
    }
    
    .sidebar-scroll::-webkit-scrollbar-thumb:hover {
      background: rgba(59, 130, 246, 0.8);
    }
  </style>

  <!-- 底部信息 -->
  <div class="p-4 border-t border-gray-700 flex-shrink-0 float-animation">
    <div class="text-xs text-gray-500 text-center transition-all duration-300 hover:text-gray-400">
      <p class="transition-transform duration-300 hover:scale-105">2024 - 2025 © 宏翔商道</p>
      <p class="mt-1 transition-transform duration-300 hover:scale-105">ICP备案：<a href="https://beian.miit.gov.cn/">苏ICP备2025160017号 </a></p>
    </div>
  </div>
</aside>
